<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 915.52466 385.66299"
   version="1.1"
   id="svg86"
   sodipodi:docname="maskimpute_pipeline.svg"
   inkscape:version="1.4.3 (1:1.4.3+202512261035+0d15f75042)"
   width="915.52466"
   height="385.66299"
   inkscape:export-filename="maskimpute_pipeline.png"
   inkscape:export-xdpi="96"
   inkscape:export-ydpi="96"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview86"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="0.90933932"
     inkscape:cx="569.64434"
     inkscape:cy="81.927613"
     inkscape:window-width="1854"
     inkscape:window-height="1011"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="g64" />
  <defs
     id="defs4">
    <style
       id="style1">
      .font { font-family: Helvetica, Arial, sans-serif; fill: #111; }
      .title { font-size: 20px; font-weight: 700; text-anchor: middle; }
      .subtitle { font-size: 13px; font-weight: 600; text-anchor: middle; }
      .label { font-size: 12px; text-anchor: middle; dominant-baseline: middle; }
      .small { font-size: 11px; }
      .math { font-family: &quot;Times New Roman&quot;, Times, serif; font-style: italic; }

      .box { fill: #fff; stroke: #111; stroke-width: 1.6; }
      .box-soft { fill: #fafafa; stroke: #111; stroke-width: 1.2; }

      .cell { fill: #f5f5f5; stroke: #999; stroke-width: 1; }
      .cell-nz { fill: #e0e0e0; }
      .cell-z { fill: #ffffff; }
      .cell-mask-nz { fill: #fff5f5; stroke: #c62828; stroke-width: 2; }
      .cell-mask-z { fill: #f3f8ff; stroke: #1565c0; stroke-width: 2; }
      .cell-rec { fill: #eef8ee; stroke: #2e7d32; stroke-width: 1.5; }

      .line { stroke: #111; stroke-width: 1.6; fill: none; }
      .dash { stroke-dasharray: 5 3; }
    </style>
    <marker
       id="arrow"
       markerWidth="10"
       markerHeight="8"
       refX="9"
       refY="4"
       orient="auto">
      <path
         d="M 0,0 V 8 L 10,4 Z"
         fill="#111111"
         id="path1" />
    </marker>
    <marker
       id="arrowRed"
       markerWidth="10"
       markerHeight="8"
       refX="9"
       refY="4"
       orient="auto">
      <path
         d="M 0,0 V 8 L 10,4 Z"
         fill="#c62828"
         id="path2" />
    </marker>
    <marker
       id="arrowBlue"
       markerWidth="10"
       markerHeight="8"
       refX="9"
       refY="4"
       orient="auto">
      <path
         d="M 0,0 V 8 L 10,4 Z"
         fill="#1565c0"
         id="path3" />
    </marker>
    <marker
       id="arrowGreen"
       markerWidth="10"
       markerHeight="8"
       refX="9"
       refY="4"
       orient="auto">
      <path
         d="M 0,0 V 8 L 10,4 Z"
         fill="#2e7d32"
         id="path4" />
    </marker>
  </defs>
  <!-- Input matrix (observed logcounts) -->
  <g
     transform="translate(0.5,122.6)"
     id="g21"
     clip-path="none">
    <text
       x="52"
       y="-8"
       class="font subtitle"
       id="text5"><tspan
         sodipodi:role="line"
         id="tspan87"
         x="52"
         y="-8">Observed X<tspan
   style="font-style:italic;font-size:65%;baseline-shift:sub"
   id="tspan265">log</tspan></tspan></text>
    <!-- 4x4 grid, 26px cells -->
    <!-- Row 1 -->
    <rect
       x="0"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect5" />
    <text
       x="13"
       y="13"
       class="font label small"
       id="text6">5.2</text>
    <rect
       x="26"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect6" />
    <text
       x="39"
       y="13"
       class="font label small"
       id="text7">0</text>
    <rect
       x="52"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect7" />
    <text
       x="65"
       y="13"
       class="font label small"
       id="text8">1.8</text>
    <rect
       x="78"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect8" />
    <text
       x="91"
       y="13"
       class="font label small"
       id="text9">0</text>
    <!-- Row 2 -->
    <rect
       x="0"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect9" />
    <text
       x="13"
       y="39"
       class="font label small"
       id="text10">0</text>
    <rect
       x="26"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect10" />
    <text
       x="39"
       y="39"
       class="font label small"
       id="text11">9.1</text>
    <rect
       x="52"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect11" />
    <text
       x="65"
       y="39"
       class="font label small"
       id="text12">0</text>
    <rect
       x="78"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect12" />
    <text
       x="91"
       y="39"
       class="font label small"
       id="text13">3.4</text>
    <!-- Row 3 -->
    <rect
       x="0"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect13" />
    <text
       x="13"
       y="65"
       class="font label small"
       id="text14">2.2</text>
    <rect
       x="26"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect14" />
    <text
       x="39"
       y="65"
       class="font label small"
       id="text15">4.5</text>
    <rect
       x="52"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect15" />
    <text
       x="65"
       y="65"
       class="font label small"
       id="text16">0</text>
    <rect
       x="78"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect16" />
    <text
       x="91"
       y="65"
       class="font label small"
       id="text17">6.7</text>
    <!-- Row 4 -->
    <rect
       x="0"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect17" />
    <text
       x="13"
       y="91"
       class="font label small"
       id="text18">0</text>
    <rect
       x="26"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect18" />
    <text
       x="39"
       y="91"
       class="font label small"
       id="text19">8.0</text>
    <rect
       x="52"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect19" />
    <text
       x="65"
       y="91"
       class="font label small"
       id="text20">1.1</text>
    <rect
       x="78"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect20" />
    <text
       x="91"
       y="91"
       class="font label small"
       id="text21">0</text>
  </g>
  <!-- Biozero estimation branch -->
  <rect
     x="165.52673"
     y="68.626732"
     width="214.94653"
     height="82.944969"
     rx="9.9975128"
     class="box-soft"
     id="rect21"
     clip-path="none" />
  <text
     x="273.5"
     y="94.599998"
     class="font subtitle"
     id="text22"
     clip-path="none">Biozero estimation</text>
  <text
     x="273.5"
     y="116.6"
     class="font label small"
     id="text23"
     clip-path="none">counts from X, ZINB + cell sparsity shrink</text>
  <text
     x="273.5"
     y="136.60001"
     class="font label small"
     id="text24"
     clip-path="none">output: p<tspan
   class="math"
   id="tspan23"
   style="font-size:65%;baseline-shift:sub">bio</tspan>(i,j)</text>
  <!-- Scale + mask/corrupt step -->
  <rect
     x="164.61353"
     y="199.69798"
     width="215"
     height="64"
     rx="10"
     class="box"
     id="rect24"
     clip-path="none" />
  <text
     x="272.61353"
     y="225.69798"
     class="font subtitle"
     id="text25"
     clip-path="none">Scale, mask, corrupt</text>
  <text
     x="272.61353"
     y="245.698"
     class="font label small"
     id="text26"
     clip-path="none">in scaled space (clip+z+minmax)</text>
  <!-- Corrupted matrix -->
  <g
     transform="translate(439.5,122.6)"
     id="g43"
     clip-path="none">
    <text
       x="52"
       y="-10"
       class="font subtitle"
       id="text27"
       style="white-space:pre;inline-size:102.042;display:inline"
       transform="translate(0,2)"
       xml:space="preserve"><tspan
         x="52"
         y="-10"
         id="tspan2">Corrupted X<tspan
   style="font-style:italic;font-size:65%;baseline-shift:sub"
   id="tspan1">log</tspan></tspan></text>
    <!-- Indicate masked nonzeros (red, filled with 0) and masked zeros (blue, filled with noise) -->
    <rect
       x="0"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect27" />
    <text
       x="13"
       y="13"
       class="font label small"
       id="text28">5.2</text>
    <rect
       x="26"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-mask-z"
       id="rect28" />
    <text
       x="39"
       y="13"
       class="font label small"
       fill="#1565c0"
       id="text29">~</text>
    <rect
       x="52"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-mask-nz"
       id="rect29" />
    <text
       x="65"
       y="13"
       class="font label small"
       fill="#c62828"
       id="text30">0</text>
    <rect
       x="78"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect30" />
    <text
       x="91"
       y="13"
       class="font label small"
       id="text31">0</text>
    <rect
       x="0"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect31" />
    <text
       x="13"
       y="39"
       class="font label small"
       id="text32">0</text>
    <rect
       x="26"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect32" />
    <text
       x="39"
       y="39"
       class="font label small"
       id="text33">9.1</text>
    <rect
       x="52"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-mask-z"
       id="rect33" />
    <text
       x="65"
       y="39"
       class="font label small"
       fill="#1565c0"
       id="text34">~</text>
    <rect
       x="78"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect34" />
    <text
       x="91"
       y="39"
       class="font label small"
       id="text35">3.4</text>
    <rect
       x="0"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-mask-nz"
       id="rect35" />
    <text
       x="13"
       y="65"
       class="font label small"
       fill="#c62828"
       id="text36">0</text>
    <rect
       x="26"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect36" />
    <text
       x="39"
       y="65"
       class="font label small"
       id="text37">4.5</text>
    <rect
       x="52"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect37" />
    <text
       x="65"
       y="65"
       class="font label small"
       id="text38">0</text>
    <rect
       x="78"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect38" />
    <text
       x="91"
       y="65"
       class="font label small"
       id="text39">6.7</text>
    <rect
       x="0"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-mask-z"
       id="rect39" />
    <text
       x="13"
       y="91"
       class="font label small"
       fill="#1565c0"
       id="text40">~</text>
    <rect
       x="26"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect40" />
    <text
       x="39"
       y="91"
       class="font label small"
       id="text41">8.0</text>
    <rect
       x="52"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-nz"
       id="rect41" />
    <text
       x="65"
       y="91"
       class="font label small"
       id="text42">1.1</text>
    <rect
       x="78"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-z"
       id="rect42" />
    <text
       x="91"
       y="91"
       class="font label small"
       id="text43">0</text>
  </g>
  <!-- Autoencoder block -->
  <g
     transform="translate(589.5,82.6)"
     id="g47"
     clip-path="none">
    <path
       d="M 0,20 V 180 L 55,130 V 70 Z"
       fill="#fff3e0"
       stroke="#ef6c00"
       stroke-width="2"
       id="path43" />
    <text
       x="-102"
       y="28"
       class="font label small"
       transform="rotate(-90)"
       id="text44">Encoder</text>
    <rect
       x="70"
       y="72"
       width="14"
       height="56"
       rx="4"
       fill="#111111"
       id="rect44" />
    <text
       x="77"
       y="150"
       class="font label small"
       id="text45">z</text>
    <path
       d="m 96,70 v 60 l 55,50 V 20 Z"
       fill="#e0f7fa"
       stroke="#0097a7"
       stroke-width="2"
       id="path45" />
    <text
       x="102"
       y="-123"
       class="font label small"
       transform="rotate(90)"
       id="text46">Decoder</text>
    <text
       x="76"
       y="200"
       class="font label small"
       id="text47">MLP + LayerNorm + SiLU</text>
  </g>
  <!-- Reconstruction matrix -->
  <g
     transform="translate(779.5,122.6)"
     id="g64"
     clip-path="none">
    <text
       x="54"
       y="-8"
       class="font subtitle"
       id="text48"><tspan
         sodipodi:role="line"
         id="tspan92"
         x="54.000004"
         y="-8">Reconstructed X<tspan
   style="font-style:italic;font-size:65%;baseline-shift:sub"
   id="tspan267">log</tspan></tspan></text>
    <rect
       x="0"
       y="0"
       width="104"
       height="104"
       rx="6"
       fill="#ffffff"
       stroke="#cccccc"
       id="rect48" />
    <rect
       x="0"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect49" />
    <rect
       x="26"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect50" />
    <rect
       x="52"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect51" />
    <rect
       x="78"
       y="0"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect52" />
    <rect
       x="0"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect53" />
    <rect
       x="26"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect54" />
    <rect
       x="52"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect55" />
    <rect
       x="78"
       y="26"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect56" />
    <rect
       x="0"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect57" />
    <rect
       x="26"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect58" />
    <rect
       x="52"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect59" />
    <rect
       x="78"
       y="52"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect60" />
    <rect
       x="0"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect61" />
    <rect
       x="26"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect62" />
    <rect
       x="52"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect63" />
    <rect
       x="78"
       y="78"
       width="26"
       height="26"
       rx="3"
       class="cell cell-rec"
       id="rect64" />
  </g>
  <!-- Keep-positive (postprocess) -->
  <rect
     x="772.5"
     y="268.60001"
     width="120"
     height="64"
     rx="10"
     class="box"
     id="rect65"
     clip-path="none" />
  <text
     x="832.5"
     y="302.60001"
     class="font subtitle"
     id="text65"
     clip-path="none">Postprocess</text>
  <!-- Loss box -->
  <rect
     x="515.5"
     y="0.60000002"
     width="300"
     height="86"
     rx="10"
     class="box-soft"
     id="rect67"
     clip-path="none" />
  <text
     x="665.5"
     y="26.6"
     class="font subtitle"
     id="text68"
     clip-path="none">Training objective</text>
  <text
     x="665.5"
     y="48.599998"
     class="font label small"
     id="text69"
     clip-path="none">L = L<tspan
   style="font-style:italic;font-size:65%;baseline-shift:sub"
   id="tspan93">mask</tspan> + γ * L<tspan
   style="font-size:65%;baseline-shift:sub"
   id="tspan94">bio</tspan></text>
  <text
     x="665.5"
     y="68.599998"
     class="font label small"
     id="text70"
     clip-path="none">γ=0 (low mse), γ=1 (balanced mse)</text>
  <!-- Main flow arrows -->
  <path
     d="m 105.25716,174.90553 59.9858,56.80526"
     class="line"
     marker-end="url(#arrow)"
     id="path70"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <path
     d="M 379.1762,231.47022 439.5,172.6"
     class="line"
     marker-end="url(#arrow)"
     id="path71"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <path
     d="m 544.5,172.6 h 45"
     class="line"
     marker-end="url(#arrow)"
     id="path72"
     clip-path="none" />
  <path
     d="m 740.5,172.6 h 39"
     class="line"
     marker-end="url(#arrow)"
     id="path73"
     clip-path="none" />
  <path
     d="m 831.5,226.6 -0.0847,41.49249"
     class="line"
     marker-end="url(#arrow)"
     id="path74"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <!-- Biozero arrows (to masking and to loss) -->
  <path
     d="m 105.82418,174.26302 c 31.49174,-29.12589 50.71494,-56.79273 60.23937,-63.56575"
     class="line dash"
     stroke="#1565c0"
     marker-end="url(#arrowBlue)"
     id="path75"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <path
     d="M 380.95917,110.59399 C 414.85947,96.29489 499.88019,50.654568 515.37869,42.606221"
     class="line dash"
     stroke="#2e7d32"
     marker-end="url(#arrowGreen)"
     id="path76"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <text
     x="451.5"
     y="60.599998"
     class="font label small"
     fill="#2e7d32"
     id="text76"
     clip-path="none">p<tspan
   style="font-style:italic;font-size:65%;baseline-shift:sub"
   id="tspan88">bio</tspan></text>
  <path
     d="m 380.40932,109.40361 c 18.49875,10.49373 76.35464,16.09609 96.03332,23.9033"
     class="line dash"
     stroke="#1565c0"
     marker-end="url(#arrowBlue)"
     id="path77"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <text
     x="421.60269"
     y="109.5003"
     class="font label small"
     fill="#1565c0"
     id="text77"
     clip-path="none">p<tspan
   style="font-style:italic;font-size:65%;baseline-shift:sub"
   id="tspan89">zero,</tspan>p<tspan
   style="font-style:italic;font-size:65%;baseline-shift:sub"
   id="tspan90">bio</tspan></text>
  <!-- Loss arrows (mask + recon) -->
  <path
     d="m 379.36097,230.83573 c 137.52106,26.4076 183.92584,67.87914 197.77055,-144.27806"
     class="line dash"
     stroke="#c62828"
     marker-end="url(#arrowRed)"
     id="path78"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <path
     d="M 883.18588,174.69068 C 964.35222,66.207212 869.46995,45.107512 815.68738,40.406611"
     class="line dash"
     stroke="#2e7d32"
     marker-end="url(#arrowGreen)"
     id="path79"
     sodipodi:nodetypes="cc"
     clip-path="none" />
  <text
     x="756.5"
     y="82.599998"
     class="font label small"
     fill="#2e7d32"
     id="text79" />
  <path
     d="m 707.36936,90.16143 v 32"
     class="line dash"
     stroke="#111"
     marker-end="url(#arrow)"
     id="path80"
     clip-path="none" />
  <text
     x="680.36938"
     y="99.16143"
     class="font label small"
     id="text80"
     clip-path="none">backprop</text>
  <!-- Legend -->
  <rect
     x="0.5"
     y="332.60001"
     width="645.05444"
     height="52.562984"
     rx="10"
     fill="#fbfbfb"
     stroke="#dddddd"
     id="rect80"
     clip-path="none" />
  <text
     x="40.274498"
     y="349.49115"
     class="font subtitle"
     text-anchor="start"
     id="text81"
     clip-path="none">Legend</text>
  <g
     transform="translate(17.5,374.6)"
     id="g86"
     clip-path="none">
    <rect
       x="0"
       y="-10"
       width="14"
       height="14"
       rx="3"
       class="cell cell-nz"
       id="rect81" />
    <text
       x="22"
       y="-2"
       class="font small"
       text-anchor="start"
       id="text82">nonzero</text>
    <rect
       x="95"
       y="-10"
       width="14"
       height="14"
       rx="3"
       class="cell cell-z"
       id="rect82" />
    <text
       x="117"
       y="-2"
       class="font small"
       text-anchor="start"
       id="text83">zero</text>
    <rect
       x="165"
       y="-10"
       width="14"
       height="14"
       rx="3"
       class="cell cell-mask-nz"
       id="rect83" />
    <text
       x="187"
       y="-2"
       class="font small"
       text-anchor="start"
       id="text84">masked nonzero (fill=0)</text>
    <rect
       x="335"
       y="-10"
       width="14"
       height="14"
       rx="3"
       class="cell cell-mask-z"
       id="rect84" />
    <text
       x="357"
       y="-2"
       class="font small"
       text-anchor="start"
       id="text85">masked zero (fill=noise)</text>
    <rect
       x="520"
       y="-10"
       width="14"
       height="14"
       rx="3"
       class="cell cell-rec"
       id="rect85" />
    <text
       x="542"
       y="-2"
       class="font small"
       text-anchor="start"
       id="text86">reconstruction</text>
  </g>
</svg>
